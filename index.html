<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Happy Birthday Ella!</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.9.0/p5.min.js"></script>
  </head>
  <body style="margin:0; overflow:hidden; background:#0a1428;">
    <script>
      let font;
      let pathPoints = [];
      let snake = [];
      let trailGraphics;
      let t = 0;
      const snakeLength = 60;  // number of segments
      let stacked = false;
      let done = false;
      let slitherAmplitude = 10;
      let slitherFrequency = 0.15;

      function preload() {
        font = loadFont("https://cdnjs.cloudflare.com/ajax/libs/topcoat/0.8.0/font/SourceCodePro-Regular.otf");
      }

      function setup() {
        createCanvas(windowWidth, windowHeight);
        trailGraphics = createGraphics(windowWidth, windowHeight);
        trailGraphics.clear();

        // Detect phone layout
        const isPortrait = windowHeight > windowWidth;
        stacked = isPortrait || windowWidth < 800;

        textFont(font);
        textSize(stacked ? min(windowWidth * 0.18, 100) : min(windowWidth * 0.08, 100));
        fill(255);

        // Build text layout
        let messages = stacked ? ["Happy", "Birthday", "Ella!"] : ["Happy Birthday Ella!"];
        pathPoints = [];
        let totalHeight = messages.length * textSize() * 1.1;
        let startY = (height - totalHeight) / 2 + textSize();

        for (let i = 0; i < messages.length; i++) {
          let msg = messages[i];
          let msgWidth = textWidth(msg);
          let startX = (width - msgWidth) / 2;

          let pts = font.textToPoints(msg, startX, startY + i * textSize() * 1.1, textSize(), {
            sampleFactor: 0.2,
            simplifyThreshold: 0
          });

          pathPoints = pathPoints.concat(pts);
        }

        frameRate(60);
      }

      function draw() {
        background(10, 20, 40, 60);
        image(trailGraphics, 0, 0);

        if (done || pathPoints.length === 0) return;

        let idx = floor(t);
        if (idx >= pathPoints.length - 1) {
          done = true;
          drawSnake(true);
          return;
        }

        let head = pathPoints[idx];
        snake.unshift({ x: head.x, y: head.y });

        if (snake.length > snakeLength) snake.pop();

        // Leave trail
        trailGraphics.noStroke();
        trailGraphics.fill(0, 255, 100, 150);
        trailGraphics.ellipse(head.x, head.y, 6, 6);

        // Draw snake
        drawSnake(false);

        t += 0.6;
      }

      function drawSnake(isFinal) {
        noStroke();
        for (let i = 0; i < snake.length; i++) {
          let seg = snake[i];
          // Add wave motion for snake-likeness
          let waveOffset = sin(frameCount * 0.2 + i * slitherFrequency) * slitherAmplitude;
          let x = seg.x;
          let y = seg.y + waveOffset;

          let sz = map(i, 0, snake.length, 12, 25);
          let c1 = color('#00ff88');
          let c2 = color('#00ffff');
          fill(lerpColor(c1, c2, i / snake.length));
          ellipse(x, y, sz);
        }

        // Glowing head
        let head = snake[0];
        if (head) {
          fill(255, 255, 150, 150);
          ellipse(head.x, head.y, 28);
          fill(0);
          ellipse(head.x + 5, head.y - 2, 4, 4); // eye
          ellipse(head.x - 5, head.y - 2, 4, 4);
        }

        // Sparkles while moving
        if (!isFinal) {
          for (let i = 0; i < 5; i++) {
            stroke(255, 255, 200, 100);
            point(random(width), random(height));
          }
        }
      }

      function windowResized() {
        resizeCanvas(windowWidth, windowHeight);
        trailGraphics = createGraphics(windowWidth, windowHeight);
        trailGraphics.clear();
        setup();
      }
    </script>
  </body>
</html>
