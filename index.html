<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Happy Birthday Ella!</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.9.0/p5.min.js"></script>
  </head>
  <body style="margin:0; overflow:hidden; background:#0a1428;">
    <script>
      let font;
      let pathPoints = [];
      let snake = [];
      let t = 0;
      const snakeLength = 80;
      let trailGraphics;
      let stacked = false;

      function preload() {
        font = loadFont("https://cdnjs.cloudflare.com/ajax/libs/topcoat/0.8.0/font/SourceCodePro-Regular.otf");
      }

      function setup() {
        createCanvas(windowWidth, windowHeight);
        trailGraphics = createGraphics(windowWidth, windowHeight);
        trailGraphics.clear();

        // More reliable check for mobile layout
        const isPortrait = windowHeight > windowWidth;
        stacked = isPortrait || windowWidth < 800;

        textFont(font);
        textSize(stacked ? min(windowWidth * 0.2, 100) : min(windowWidth * 0.08, 100));
        fill(255);

        // If portrait/small screen, stack words vertically
        let messages = stacked
          ? ["Happy", "Birthday", "Ella!"]
          : ["Happy Birthday Ella!"];

        pathPoints = [];
        const totalHeight = messages.length * textSize() * 1.1;
        const startY = (height - totalHeight) / 2 + textSize();

        for (let i = 0; i < messages.length; i++) {
          const msg = messages[i];
          const msgWidth = textWidth(msg);
          const startX = (width - msgWidth) / 2;

          const pts = font.textToPoints(
            msg,
            startX,
            startY + i * textSize() * 1.1,
            textSize(),
            {
              sampleFactor: 0.18,
              simplifyThreshold: 0
            }
          );
          pathPoints = pathPoints.concat(pts);
        }

        frameRate(60);
      }

      function draw() {
        background(10, 20, 40, 60);

        if (pathPoints.length === 0) return;

        const idx = floor(t) % pathPoints.length;
        const pos = pathPoints[idx];
        snake.push({ x: pos.x, y: pos.y });

        if (snake.length > snakeLength) snake.shift();

        // Leave trail
        trailGraphics.noStroke();
        trailGraphics.fill(0, 255, 100, 150);
        trailGraphics.ellipse(pos.x, pos.y, 8, 8);

        image(trailGraphics, 0, 0);

        // Snake body
        noStroke();
        for (let i = 0; i < snake.length; i++) {
          const seg = snake[i];
          const sz = map(i, 0, snake.length, 8, 20);
          fill(lerpColor(color("#00ff88"), color("#00ffff"), i / snake.length));
          ellipse(seg.x, seg.y + sin(i * 0.3 + frameCount * 0.1) * 3, sz);
        }

        // Snake head glow
        const head = snake[snake.length - 1];
        if (head) {
          fill(255, 255, 150, 150);
          ellipse(head.x, head.y, 25);
        }

        // Sparkles
        for (let i = 0; i < 5; i++) {
          stroke(255, 255, 200, 100);
          point(random(width), random(height));
        }

        noStroke();
        t += 0.6;
        if (t >= pathPoints.length) t = 0;
      }

      function windowResized() {
        resizeCanvas(windowWidth, windowHeight);
        trailGraphics = createGraphics(windowWidth, windowHeight);
        trailGraphics.clear();
        setup(); // Recalculate on orientation or size change
      }
    </script>
  </body>
</html>
